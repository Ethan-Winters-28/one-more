<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Citizen Feedback Analytics - Nigam Setu Admin Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .citizen-feedback-section {
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        /* Enhanced Header Section */
        .section-header {
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
        }

        .section-header::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, #00ffc6, #00d1ff, #00ff94);
            border-radius: 2px;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .section-title {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #00ffc6 0%, #00d1ff 50%, #00ff94 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px rgba(0, 255, 198, 0.3);
        }

        .section-subtitle {
            font-size: 1.25rem;
            color: #94a3b8;
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
        }

        .section-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .quick-stat {
            text-align: center;
        }

        .quick-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #00ffc6;
        }

        .quick-stat-label {
            font-size: 0.875rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Enhanced Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .summary-card {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 255, 198, 0.2);
            border-radius: 1.5rem;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            transform-style: preserve-3d;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(0, 255, 198, 0.1) 0%, 
                rgba(0, 209, 255, 0.1) 50%, 
                rgba(0, 255, 148, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: -1;
        }

        .summary-card::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00ffc6, #00d1ff, #00ff94, #ffcc00);
            border-radius: 1.5rem;
            z-index: -2;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .summary-card:hover {
            transform: translateY(-10px) rotateX(5deg) rotateY(5deg);
            border-color: rgba(0, 255, 198, 0.6);
            box-shadow: 
                0 25px 50px rgba(0, 255, 198, 0.25),
                0 0 0 1px rgba(0, 255, 198, 0.1);
        }

        .summary-card:hover::before {
            opacity: 1;
        }

        .summary-card:hover::after {
            opacity: 0.3;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .card-icon {
            width: 4rem;
            height: 4rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .card-icon::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 1rem;
            padding: 2px;
            background: linear-gradient(45deg, currentColor, transparent, currentColor);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
        }

        .card-icon.cyan { 
            background: rgba(0, 255, 198, 0.2); 
            color: #00ffc6;
            box-shadow: 0 0 30px rgba(0, 255, 198, 0.4);
        }
        .card-icon.teal { 
            background: rgba(0, 209, 255, 0.2); 
            color: #00d1ff;
            box-shadow: 0 0 30px rgba(0, 209, 255, 0.4);
        }
        .card-icon.green { 
            background: rgba(0, 255, 148, 0.2); 
            color: #00ff94;
            box-shadow: 0 0 30px rgba(0, 255, 148, 0.4);
        }
        .card-icon.red { 
            background: rgba(255, 59, 59, 0.2); 
            color: #ff3b3b;
            box-shadow: 0 0 30px rgba(255, 59, 59, 0.4);
        }
        .card-icon.yellow { 
            background: rgba(255, 204, 0, 0.2); 
            color: #ffcc00;
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.4);
        }

        .card-trend {
            font-size: 0.875rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 600;
        }

        .trend-up {
            background: rgba(0, 255, 148, 0.2);
            color: #00ff94;
            border: 1px solid rgba(0, 255, 148, 0.3);
        }

        .trend-down {
            background: rgba(255, 59, 59, 0.2);
            color: #ff3b3b;
            border: 1px solid rgba(255, 59, 59, 0.3);
        }

        .card-value {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #00ffc6, #00d1ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        .card-label {
            font-size: 1.125rem;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 0.5rem;
        }

        .card-subtext {
            font-size: 0.875rem;
            color: #94a3b8;
            line-height: 1.4;
        }

        .card-progress {
            margin-top: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(148, 163, 184, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffc6, #00d1ff);
            border-radius: 3px;
            transition: width 2s ease-out;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmerProgress 2s infinite;
        }

        @keyframes shimmerProgress {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            font-size: 0.75rem;
            color: #94a3b8;
            display: flex;
            justify-content: space-between;
        }

        /* Enhanced Alert System */
        .alert-system {
            margin-bottom: 3rem;
        }

        .alert-box {
            background: rgba(255, 59, 59, 0.1);
            border: 1px solid rgba(255, 59, 59, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
            animation: alertPulse 3s infinite;
        }

        .alert-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 59, 59, 0.1), transparent);
            animation: alertSweep 3s infinite;
        }

        @keyframes alertPulse {
            0%, 100% { 
                border-color: rgba(255, 59, 59, 0.3);
                box-shadow: 0 0 0 0 rgba(255, 59, 59, 0.4);
            }
            50% { 
                border-color: rgba(255, 59, 59, 0.6);
                box-shadow: 0 0 0 10px rgba(255, 59, 59, 0);
            }
        }

        @keyframes alertSweep {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .alert-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .alert-icon {
            font-size: 2rem;
            color: #ff3b3b;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .alert-text {
            flex: 1;
        }

        .alert-title {
            color: #ff3b3b;
            font-weight: 700;
            font-size: 1.125rem;
            margin-bottom: 0.25rem;
        }

        .alert-description {
            color: #fca5a5;
            font-size: 0.875rem;
        }

        .alert-actions {
            display: flex;
            gap: 0.75rem;
        }

        .alert-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .alert-btn.primary {
            background: #ff3b3b;
            color: white;
        }

        .alert-btn.primary:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .alert-btn.secondary {
            background: rgba(255, 59, 59, 0.2);
            color: #ff3b3b;
            border: 1px solid rgba(255, 59, 59, 0.3);
        }

        .alert-btn.secondary:hover {
            background: rgba(255, 59, 59, 0.3);
        }

        /* Advanced Analytics Dashboard */
        .analytics-dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .main-analytics {
            display: grid;
            gap: 2rem;
        }

        .sidebar-analytics {
            display: grid;
            gap: 2rem;
        }

        .analytics-widget {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 255, 198, 0.2);
            border-radius: 1.5rem;
            padding: 2rem;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .analytics-widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #00ffc6, #00d1ff, #00ff94);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .analytics-widget:hover {
            border-color: rgba(0, 255, 198, 0.4);
            box-shadow: 0 20px 40px rgba(0, 255, 198, 0.15);
            transform: translateY(-5px);
        }

        .analytics-widget:hover::before {
            opacity: 1;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .widget-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #e2e8f0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .widget-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            background: rgba(0, 255, 198, 0.2);
            color: #00ffc6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .widget-controls {
            display: flex;
            gap: 0.5rem;
        }

        .widget-btn {
            padding: 0.5rem;
            border-radius: 0.5rem;
            background: rgba(0, 255, 198, 0.1);
            border: 1px solid rgba(0, 255, 198, 0.2);
            color: #00ffc6;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .widget-btn:hover {
            background: rgba(0, 255, 198, 0.2);
            border-color: rgba(0, 255, 198, 0.4);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 1rem;
        }

        .chart-container.small {
            height: 250px;
        }

        .chart-container.large {
            height: 500px;
        }

        /* Enhanced Feedback Table */
        .feedback-table-container {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(0, 255, 198, 0.2);
            border-radius: 1.5rem;
            overflow: hidden;
            margin-bottom: 3rem;
        }

        .table-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(0, 255, 198, 0.2);
            background: rgba(0, 255, 198, 0.05);
        }

        .table-title-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .table-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #e2e8f0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .table-stats {
            display: flex;
            gap: 2rem;
            font-size: 0.875rem;
            color: #94a3b8;
        }

        .table-controls {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 1rem;
            align-items: center;
        }

        .search-container {
            position: relative;
        }

        .search-input {
            width: 100%;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(0, 255, 198, 0.3);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem 0.75rem 3rem;
            color: #e2e8f0;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #00ffc6;
            box-shadow: 0 0 0 3px rgba(0, 255, 198, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 1rem;
        }

        .filter-select {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(0, 255, 198, 0.3);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            color: #e2e8f0;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #00ffc6;
            box-shadow: 0 0 0 3px rgba(0, 255, 198, 0.1);
        }

        .export-btn {
            background: linear-gradient(135deg, #00ffc6, #00d1ff);
            border: none;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: #0f172a;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 255, 198, 0.3);
        }

        .feedback-table {
            width: 100%;
            border-collapse: collapse;
        }

        .feedback-table th {
            background: rgba(0, 255, 198, 0.1);
            padding: 1.5rem 1rem;
            text-align: left;
            font-weight: 700;
            color: #00ffc6;
            border-bottom: 1px solid rgba(0, 255, 198, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .feedback-table th:hover {
            background: rgba(0, 255, 198, 0.2);
        }

        .feedback-table th::after {
            content: '↕️';
            position: absolute;
            right: 0.5rem;
            opacity: 0.5;
            font-size: 0.75rem;
        }

        .feedback-table td {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            vertical-align: top;
            transition: all 0.3s ease;
        }

        .feedback-table tr:hover {
            background: rgba(0, 255, 198, 0.05);
        }

        .citizen-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .citizen-avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #00ffc6, #00d1ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #0f172a;
            font-size: 0.875rem;
        }

        .citizen-details h4 {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 0.25rem;
        }

        .citizen-details p {
            font-size: 0.875rem;
            color: #94a3b8;
        }

        .ward-badge {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: rgba(0, 209, 255, 0.2);
            color: #00d1ff;
            border: 1px solid rgba(0, 209, 255, 0.3);
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rating-stars {
            display: flex;
            gap: 0.25rem;
        }

        .star {
            color: #ffcc00;
            font-size: 1.25rem;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            transition: all 0.3s ease;
        }

        .star.empty {
            color: #475569;
            text-shadow: none;
        }

        .rating-value {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 0.875rem;
        }

        .sentiment-badge {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sentiment-positive {
            background: rgba(0, 255, 148, 0.2);
            color: #00ff94;
            border: 1px solid rgba(0, 255, 148, 0.3);
        }

        .sentiment-neutral {
            background: rgba(255, 204, 0, 0.2);
            color: #ffcc00;
            border: 1px solid rgba(255, 204, 0, 0.3);
        }

        .sentiment-negative {
            background: rgba(255, 59, 59, 0.2);
            color: #ff3b3b;
            border: 1px solid rgba(255, 59, 59, 0.3);
        }

        .feedback-message {
            max-width: 350px;
            position: relative;
        }

        .message-preview {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .message-preview:hover {
            color: #00ffc6;
        }

        .message-full {
            display: none;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(0, 255, 198, 0.3);
            border-radius: 0.75rem;
            padding: 1rem;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 10;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }

        .date-display {
            color: #94a3b8;
            font-size: 0.875rem;
        }

        .date-time {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 0.25rem;
        }

        /* Real-time Updates */
        .realtime-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #00ff94;
            margin-bottom: 1rem;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff94;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(0, 255, 148, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(0, 255, 148, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(0, 255, 148, 0);
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .analytics-dashboard {
                grid-template-columns: 1fr;
            }
            
            .table-controls {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        @media (max-width: 768px) {
            .citizen-feedback-section {
                padding: 1rem;
            }

            .section-title {
                font-size: 2.5rem;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .section-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .feedback-table {
                font-size: 0.875rem;
            }

            .feedback-table th,
            .feedback-table td {
                padding: 1rem 0.5rem;
            }

            .chart-container {
                height: 300px;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .skeleton {
            background: linear-gradient(90deg, rgba(148, 163, 184, 0.1) 25%, rgba(148, 163, 184, 0.2) 50%, rgba(148, 163, 184, 0.1) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <div class="citizen-feedback-section">
        <!-- Enhanced Section Header -->
        <div class="section-header">
            <h1 class="section-title">Citizen Feedback Analytics</h1>
            <p class="section-subtitle">
                Comprehensive analysis of citizen reviews, ratings, and sentiment across all wards and departments with real-time insights and predictive analytics
            </p>
            <div class="section-stats">
                <div class="quick-stat">
                    <div class="quick-stat-value" id="responseRate">94.2%</div>
                    <div class="quick-stat-label">Response Rate</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value" id="avgResponseTime">2.4h</div>
                    <div class="quick-stat-label">Avg Response Time</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value" id="satisfactionScore">4.3</div>
                    <div class="quick-stat-label">Satisfaction Score</div>
                </div>
            </div>
        </div>

        <!-- Real-time Indicator -->
        <div class="realtime-indicator">
            <div class="pulse-dot"></div>
            <span>Live data • Last updated: <span id="lastUpdated">Just now</span></span>
        </div>

        <!-- Enhanced Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card">
                <div class="card-header">
                    <div class="card-icon cyan">📊</div>
                    <div class="card-trend trend-up">↗ +12.5%</div>
                </div>
                <div class="card-value" id="totalFeedback">2,847</div>
                <div class="card-label">Total Feedback Received</div>
                <div class="card-subtext">All citizen reviews submitted across 24 wards this month</div>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%"></div>
                    </div>
                    <div class="progress-text">
                        <span>Monthly Target</span>
                        <span>85% Complete</span>
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-header">
                    <div class="card-icon teal">⭐</div>
                    <div class="card-trend trend-up">↗ +0.3</div>
                </div>
                <div class="card-value" id="averageRating">4.3</div>
                <div class="card-label">Average Rating</div>
                <div class="card-subtext">Across all wards and services with 95% confidence interval</div>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 86%"></div>
                    </div>
                    <div class="progress-text">
                        <span>Target: 5.0</span>
                        <span>86% Achievement</span>
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-header">
                    <div class="card-icon green">👍</div>
                    <div class="card-trend trend-up">↗ +8.2%</div>
                </div>
                <div class="card-value" id="positiveFeedback">2,156</div>
                <div class="card-label">Positive Feedback</div>
                <div class="card-subtext">AI-powered sentiment analysis with 94.7% accuracy</div>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 76%"></div>
                    </div>
                    <div class="progress-text">
                        <span>75.7% Positive</span>
                        <span>Above Average</span>
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-header">
                    <div class="card-icon red">👎</div>
                    <div class="card-trend trend-down">↘ -3.1%</div>
                </div>
                <div class="card-value" id="negativeFeedback">341</div>
                <div class="card-label">Negative Feedback</div>
                <div class="card-subtext">Requires immediate attention and follow-up action</div>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 12%" data-color="red"></div>
                    </div>
                    <div class="progress-text">
                        <span>12% Negative</span>
                        <span>Improving</span>
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-header">
                    <div class="card-icon yellow">⚡</div>
                    <div class="card-trend trend-up">↗ +15.7%</div>
                </div>
                <div class="card-value" id="resolutionRate">87.3%</div>
                <div class="card-label">Resolution Rate</div>
                <div class="card-subtext">Issues resolved within 48 hours of reporting</div>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 87%"></div>
                    </div>
                    <div class="progress-text">
                        <span>Target: 90%</span>
                        <span>97% Achievement</span>
                    </div>
                </div>
            </div>

            <div class="summary-card">
                <div class="card-header">
                    <div class="card-icon cyan">🎯</div>
                    <div class="card-trend trend-up">↗ +5.4%</div>
                </div>
                <div class="card-value" id="engagementScore">92.1%</div>
                <div class="card-label">Citizen Engagement</div>
                <div class="card-subtext">Active participation in feedback and follow-up surveys</div>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 92%"></div>
                    </div>
                    <div class="progress-text">
                        <span>Excellent</span>
                        <span>Top 5% Nationally</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Alert System -->
        <div class="alert-system">
            <div class="alert-box">
                <div class="alert-content">
                    <div class="alert-icon">🚨</div>
                    <div class="alert-text">
                        <div class="alert-title">Critical: 7 Wards Require Immediate Attention</div>
                        <div class="alert-description">
                            Wards 3, 7, 12, 15, 18, 21, and 24 showing predominantly negative feedback patterns. Average rating below 2.5 stars.
                        </div>
                    </div>
                    <div class="alert-actions">
                        <button class="alert-btn primary">View Details</button>
                        <button class="alert-btn secondary">Generate Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Analytics Dashboard -->
        <div class="analytics-dashboard">
            <div class="main-analytics">
                <!-- Sentiment Trend Chart -->
                <div class="analytics-widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <div class="widget-icon">📈</div>
                            Sentiment Analysis Trends
                        </div>
                        <div class="widget-controls">
                            <button class="widget-btn" onclick="updateTimeframe('7d')">7D</button>
                            <button class="widget-btn" onclick="updateTimeframe('30d')">30D</button>
                            <button class="widget-btn" onclick="updateTimeframe('90d')">90D</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="sentimentTrendChart"></canvas>
                    </div>
                </div>

                <!-- Ward Performance Comparison -->
                <div class="analytics-widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <div class="widget-icon">🏘️</div>
                            Ward Performance Analysis
                        </div>
                        <div class="widget-controls">
                            <button class="widget-btn" onclick="toggleChartType('bar')">Bar</button>
                            <button class="widget-btn" onclick="toggleChartType('radar')">Radar</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="wardPerformanceChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="sidebar-analytics">
                <!-- Department Ratings -->
                <div class="analytics-widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <div class="widget-icon">🏢</div>
                            Department Ratings
                        </div>
                    </div>
                    <div class="chart-container small">
                        <canvas id="departmentRatingsChart"></canvas>
                    </div>
                </div>

                <!-- Response Time Analysis -->
                <div class="analytics-widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <div class="widget-icon">⏱️</div>
                            Response Time Distribution
                        </div>
                    </div>
                    <div class="chart-container small">
                        <canvas id="responseTimeChart"></canvas>
                    </div>
                </div>

                <!-- Keyword Cloud -->
                <div class="analytics-widget">
                    <div class="widget-header">
                        <div class="widget-title">
                            <div class="widget-icon">☁️</div>
                            Feedback Keywords
                        </div>
                    </div>
                    <div class="chart-container small">
                        <canvas id="keywordChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Feedback Table -->
        <div class="feedback-table-container">
            <div class="table-header">
                <div class="table-title-section">
                    <h2 class="table-title">
                        <span>📋</span>
                        Detailed Feedback Records
                    </h2>
                    <div class="table-stats">
                        <span>Showing <strong id="showingCount">50</strong> of <strong id="totalCount">2,847</strong> records</span>
                        <span>•</span>
                        <span>Updated <strong>2 minutes ago</strong></span>
                    </div>
                </div>
                <div class="table-controls">
                    <div class="search-container">
                        <div class="search-icon">🔍</div>
                        <input type="text" class="search-input" placeholder="Search by name, message, or ward..." id="searchInput">
                    </div>
                    <select class="filter-select" id="wardFilter">
                        <option value="">All Wards</option>
                        <option value="ward1">Ward 1 - Central</option>
                        <option value="ward2">Ward 2 - North</option>
                        <option value="ward3">Ward 3 - South</option>
                        <option value="ward4">Ward 4 - East</option>
                        <option value="ward5">Ward 5 - West</option>
                    </select>
                    <select class="filter-select" id="sentimentFilter">
                        <option value="">All Sentiments</option>
                        <option value="positive">Positive</option>
                        <option value="neutral">Neutral</option>
                        <option value="negative">Negative</option>
                    </select>
                    <select class="filter-select" id="ratingFilter">
                        <option value="">All Ratings</option>
                        <option value="5">5 Stars</option>
                        <option value="4">4 Stars</option>
                        <option value="3">3 Stars</option>
                        <option value="2">2 Stars</option>
                        <option value="1">1 Star</option>
                    </select>
                    <button class="export-btn" onclick="exportData()">
                        <span>📊</span>
                        Export
                    </button>
                </div>
            </div>

            <table class="feedback-table">
                <thead>
                    <tr>
                        <th onclick="sortTable(0)">Citizen Details</th>
                        <th onclick="sortTable(1)">Ward/Department</th>
                        <th onclick="sortTable(2)">Rating</th>
                        <th onclick="sortTable(3)">Feedback Message</th>
                        <th onclick="sortTable(4)">Sentiment</th>
                        <th onclick="sortTable(5)">Submitted</th>
                    </tr>
                </thead>
                <tbody id="feedbackTableBody">
                    <!-- Table rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Enhanced sample data with more realistic entries
        const feedbackData = [
            {
                name: "Rajesh Kumar Singh",
                email: "rajesh.kumar@email.com",
                ward: "Ward 1 - Sanitation",
                department: "Waste Management",
                rating: 5,
                message: "Excellent garbage collection service! The new automated trucks are working perfectly. Collection is always on time at 6 AM sharp. The workers are very professional and courteous. This is a significant improvement from last year.",
                sentiment: "positive",
                date: "2024-01-15 10:30 AM",
                responseTime: "2.5h",
                resolved: true,
                priority: "low"
            },
            {
                name: "Priya Sharma Gupta",
                email: "priya.sharma@email.com",
                ward: "Ward 3 - Water Supply",
                department: "Municipal Water",
                rating: 2,
                message: "Water supply has been irregular for the past 3 weeks. We get water only for 2 hours in the morning and 1 hour in the evening. This is causing major inconvenience for families with children. The pressure is also very low when water does come.",
                sentiment: "negative",
                date: "2024-01-14 02:15 PM",
                responseTime: "6.2h",
                resolved: false,
                priority: "high"
            },
            {
                name: "Amit Patel",
                email: "amit.patel@email.com",
                ward: "Ward 2 - Road Maintenance",
                department: "Public Works",
                rating: 4,
                message: "The road repair work on MG Road was completed well. The quality of work is good and the road is much smoother now. However, it took 3 weeks longer than the promised timeline. Better project management needed.",
                sentiment: "neutral",
                date: "2024-01-13 09:45 AM",
                responseTime: "1.8h",
                resolved: true,
                priority: "medium"
            },
            {
                name: "Sunita Devi Agarwal",
                email: "sunita.devi@email.com",
                ward: "Ward 1 - Street Lighting",
                department: "Electrical Services",
                rating: 5,
                message: "The new LED street lights installed last month are fantastic! Our entire street is now well-lit and feels much safer, especially for women and children walking at night. Energy efficient and bright. Excellent work by the team.",
                sentiment: "positive",
                date: "2024-01-12 07:20 PM",
                responseTime: "0.5h",
                resolved: true,
                priority: "low"
            },
            {
                name: "Vikram Singh Rathore",
                email: "vikram.singh@email.com",
                ward: "Ward 4 - Public Health",
                department: "Health & Sanitation",
                rating: 1,
                message: "Mosquito control measures are completely inadequate in our area. Despite multiple complaints, no fogging has been done in the last 2 months. Dengue and malaria cases are increasing rapidly. This is a serious public health emergency that needs immediate action.",
                sentiment: "negative",
                date: "2024-01-11 11:00 AM",
                responseTime: "12.5h",
                resolved: false,
                priority: "critical"
            },
            {
                name: "Meera Joshi Mehta",
                email: "meera.joshi@email.com",
                ward: "Ward 2 - Parks & Recreation",
                department: "Parks Department",
                rating: 4,
                message: "The newly renovated Central Park looks beautiful with new playground equipment and walking tracks. Children love the new swings and slides. However, the park needs more maintenance staff as garbage bins are often overflowing and some equipment needs regular cleaning.",
                sentiment: "positive",
                date: "2024-01-10 04:30 PM",
                responseTime: "3.2h",
                resolved: true,
                priority: "low"
            },
            {
                name: "Dr. Arjun Malhotra",
                email: "arjun.malhotra@email.com",
                ward: "Ward 5 - Healthcare",
                department: "Primary Health Center",
                rating: 3,
                message: "The primary health center has improved its services but still lacks adequate staff during peak hours. Waiting time is often 2-3 hours for basic consultations. Need more doctors and nurses to handle the patient load efficiently.",
                sentiment: "neutral",
                date: "2024-01-09 01:15 PM",
                responseTime: "4.7h",
                resolved: false,
                priority: "medium"
            },
            {
                name: "Kavita Reddy",
                email: "kavita.reddy@email.com",
                ward: "Ward 3 - Traffic Management",
                department: "Traffic Police",
                rating: 5,
                message: "Excellent traffic management during the festival season! The new traffic signals and proper lane markings have significantly reduced congestion on the main roads. Traffic police personnel are doing a great job managing the flow.",
                sentiment: "positive",
                date: "2024-01-08 08:45 AM",
                responseTime: "1.2h",
                resolved: true,
                priority: "low"
            }
        ];

        // Chart configurations and data
        let sentimentChart, wardChart, departmentChart, responseChart, keywordChart;

        // Initialize all charts
        function initializeCharts() {
            initSentimentTrendChart();
            initWardPerformanceChart();
            initDepartmentRatingsChart();
            initResponseTimeChart();
            initKeywordChart();
        }

        // Sentiment Trend Chart
        function initSentimentTrendChart() {
            const ctx = document.getElementById('sentimentTrendChart').getContext('2d');
            
            const gradient1 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient1.addColorStop(0, 'rgba(0, 255, 148, 0.3)');
            gradient1.addColorStop(1, 'rgba(0, 255, 148, 0.05)');
            
            const gradient2 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient2.addColorStop(0, 'rgba(255, 204, 0, 0.3)');
            gradient2.addColorStop(1, 'rgba(255, 204, 0, 0.05)');
            
            const gradient3 = ctx.createLinearGradient(0, 0, 0, 400);
            gradient3.addColorStop(0, 'rgba(255, 59, 59, 0.3)');
            gradient3.addColorStop(1, 'rgba(255, 59, 59, 0.05)');

            sentimentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
                    datasets: [{
                        label: 'Positive',
                        data: [65, 72, 68, 75, 78, 82, 79, 85],
                        borderColor: '#00ff94',
                        backgroundColor: gradient1,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#00ff94',
                        pointBorderColor: '#0f172a',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }, {
                        label: 'Neutral',
                        data: [25, 20, 24, 18, 16, 12, 15, 10],
                        borderColor: '#ffcc00',
                        backgroundColor: gradient2,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ffcc00',
                        pointBorderColor: '#0f172a',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }, {
                        label: 'Negative',
                        data: [10, 8, 8, 7, 6, 6, 6, 5],
                        borderColor: '#ff3b3b',
                        backgroundColor: gradient3,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ff3b3b',
                        pointBorderColor: '#0f172a',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    size: 12,
                                    weight: '600'
                                },
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#e2e8f0',
                            bodyColor: '#94a3b8',
                            borderColor: 'rgba(0, 255, 198, 0.3)',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 11
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 11
                                },
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Ward Performance Chart
        function initWardPerformanceChart() {
            const ctx = document.getElementById('wardPerformanceChart').getContext('2d');
            
            wardChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Ward 1', 'Ward 2', 'Ward 3', 'Ward 4', 'Ward 5', 'Ward 6', 'Ward 7', 'Ward 8'],
                    datasets: [{
                        label: 'Average Rating',
                        data: [4.5, 4.2, 2.1, 3.8, 4.6, 4.1, 2.3, 4.4],
                        backgroundColor: function(context) {
                            const value = context.parsed.y;
                            if (value >= 4) return 'rgba(0, 255, 148, 0.8)';
                            if (value >= 3) return 'rgba(255, 204, 0, 0.8)';
                            return 'rgba(255, 59, 59, 0.8)';
                        },
                        borderColor: function(context) {
                            const value = context.parsed.y;
                            if (value >= 4) return '#00ff94';
                            if (value >= 3) return '#ffcc00';
                            return '#ff3b3b';
                        },
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#e2e8f0',
                            bodyColor: '#94a3b8',
                            borderColor: 'rgba(0, 255, 198, 0.3)',
                            borderWidth: 1,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `Rating: ${context.parsed.y}/5.0`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 11
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 5,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 11
                                },
                                stepSize: 1
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Department Ratings Chart
        function initDepartmentRatingsChart() {
            const ctx = document.getElementById('departmentRatingsChart').getContext('2d');
            
            departmentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Sanitation', 'Water Supply', 'Roads', 'Healthcare', 'Parks', 'Traffic'],
                    datasets: [{
                        data: [4.5, 3.2, 4.1, 3.8, 4.3, 4.6],
                        backgroundColor: [
                            'rgba(0, 255, 198, 0.8)',
                            'rgba(255, 59, 59, 0.8)',
                            'rgba(0, 255, 148, 0.8)',
                            'rgba(255, 204, 0, 0.8)',
                            'rgba(0, 209, 255, 0.8)',
                            'rgba(147, 51, 234, 0.8)'
                        ],
                        borderColor: [
                            '#00ffc6',
                            '#ff3b3b',
                            '#00ff94',
                            '#ffcc00',
                            '#00d1ff',
                            '#9333ea'
                        ],
                        borderWidth: 3,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    size: 10
                                },
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#e2e8f0',
                            bodyColor: '#94a3b8',
                            borderColor: 'rgba(0, 255, 198, 0.3)',
                            borderWidth: 1,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}/5.0`;
                                }
                            }
                        }
                    },
                    cutout: '60%',
                    animation: {
                        animateRotate: true,
                        duration: 2000
                    }
                }
            });
        }

        // Response Time Chart
        function initResponseTimeChart() {
            const ctx = document.getElementById('responseTimeChart').getContext('2d');
            
            responseChart = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: ['< 1 hour', '1-4 hours', '4-12 hours', '12-24 hours', '> 24 hours'],
                    datasets: [{
                        data: [35, 28, 20, 12, 5],
                        backgroundColor: [
                            'rgba(0, 255, 148, 0.8)',
                            'rgba(0, 255, 198, 0.8)',
                            'rgba(255, 204, 0, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(255, 59, 59, 0.8)'
                        ],
                        borderColor: [
                            '#00ff94',
                            '#00ffc6',
                            '#ffcc00',
                            '#ff9f40',
                            '#ff3b3b'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e2e8f0',
                                font: {
                                    size: 9
                                },
                                padding: 10
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#e2e8f0',
                            bodyColor: '#94a3b8',
                            borderColor: 'rgba(0, 255, 198, 0.3)',
                            borderWidth: 1,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            ticks: {
                                display: false
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.2)'
                            }
                        }
                    },
                    animation: {
                        duration: 2000
                    }
                }
            });
        }

        // Keyword Chart (Word Cloud simulation)
        function initKeywordChart() {
            const ctx = document.getElementById('keywordChart').getContext('2d');
            
            keywordChart = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Keywords',
                        data: [
                            {x: 20, y: 30, r: 25, keyword: 'excellent'},
                            {x: 40, y: 20, r: 20, keyword: 'poor'},
                            {x: 60, y: 40, r: 30, keyword: 'service'},
                            {x: 30, y: 60, r: 15, keyword: 'clean'},
                            {x: 70, y: 25, r: 18, keyword: 'delay'},
                            {x: 50, y: 70, r: 22, keyword: 'quality'},
                            {x: 80, y: 50, r: 12, keyword: 'staff'},
                            {x: 25, y: 80, r: 16, keyword: 'fast'}
                        ],
                        backgroundColor: function(context) {
                            const keywords = ['excellent', 'service', 'clean', 'quality', 'fast'];
                            const negativeKeywords = ['poor', 'delay'];
                            const keyword = context.raw.keyword;
                            
                            if (keywords.includes(keyword)) {
                                return 'rgba(0, 255, 148, 0.7)';
                            } else if (negativeKeywords.includes(keyword)) {
                                return 'rgba(255, 59, 59, 0.7)';
                            }
                            return 'rgba(255, 204, 0, 0.7)';
                        },
                        borderColor: function(context) {
                            const keywords = ['excellent', 'service', 'clean', 'quality', 'fast'];
                            const negativeKeywords = ['poor', 'delay'];
                            const keyword = context.raw.keyword;
                            
                            if (keywords.includes(keyword)) {
                                return '#00ff94';
                            } else if (negativeKeywords.includes(keyword)) {
                                return '#ff3b3b';
                            }
                            return '#ffcc00';
                        },
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#e2e8f0',
                            bodyColor: '#94a3b8',
                            borderColor: 'rgba(0, 255, 198, 0.3)',
                            borderWidth: 1,
                            cornerRadius: 8,
                            callbacks: {
                                title: function(context) {
                                    return context[0].raw.keyword;
                                },
                                label: function(context) {
                                    return `Frequency: ${context.raw.r * 2}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: false,
                            min: 0,
                            max: 100
                        },
                        y: {
                            display: false,
                            min: 0,
                            max: 100
                        }
                    },
                    animation: {
                        duration: 2000
                    }
                }
            });
        }

        // Generate enhanced components
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                stars += `<span class="star ${i <= rating ? '' : 'empty'}">★</span>`;
            }
            return `
                <div class="rating-display">
                    <div class="rating-stars">${stars}</div>
                    <span class="rating-value">${rating}/5</span>
                </div>
            `;
        }

        function generateSentimentBadge(sentiment) {
            const badges = {
                positive: { icon: '✅', text: 'Positive' },
                neutral: { icon: '⚠️', text: 'Neutral' },
                negative: { icon: '❌', text: 'Negative' }
            };
            const badge = badges[sentiment];
            return `<span class="sentiment-badge sentiment-${sentiment}">${badge.icon} ${badge.text}</span>`;
        }

        function generateCitizenAvatar(name) {
            const initials = name.split(' ').map(n => n[0]).join('').substring(0, 2);
            return `<div class="citizen-avatar">${initials}</div>`;
        }

        // Enhanced table population
        function populateTable(data = feedbackData) {
            const tbody = document.getElementById('feedbackTableBody');
            tbody.innerHTML = '';

            data.forEach((feedback, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="citizen-info">
                            ${generateCitizenAvatar(feedback.name)}
                            <div class="citizen-details">
                                <h4>${feedback.name}</h4>
                                <p>${feedback.email}</p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="ward-badge">${feedback.ward}</div>
                        <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.25rem;">
                            ${feedback.department}
                        </div>
                    </td>
                    <td>${generateStars(feedback.rating)}</td>
                    <td>
                        <div class="feedback-message">
                            <div class="message-preview" onclick="toggleMessage(${index})">
                                ${feedback.message}
                            </div>
                            <div class="message-full" id="message-${index}">
                                ${feedback.message}
                            </div>
                        </div>
                    </td>
                    <td>${generateSentimentBadge(feedback.sentiment)}</td>
                    <td>
                        <div class="date-display">
                            <div class="date-time">${feedback.date.split(' ')[0]}</div>
                            <div>${feedback.date.split(' ')[1]} ${feedback.date.split(' ')[2]}</div>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Update showing count
            document.getElementById('showingCount').textContent = data.length;
        }

        // Enhanced filtering
        function filterFeedback() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const wardFilter = document.getElementById('wardFilter').value;
            const sentimentFilter = document.getElementById('sentimentFilter').value;
            const ratingFilter = document.getElementById('ratingFilter').value;

            const filteredData = feedbackData.filter(feedback => {
                const matchesSearch = feedback.name.toLowerCase().includes(searchTerm) ||
                                    feedback.message.toLowerCase().includes(searchTerm) ||
                                    feedback.email.toLowerCase().includes(searchTerm) ||
                                    feedback.ward.toLowerCase().includes(searchTerm);
                
                const matchesWard = !wardFilter || feedback.ward.toLowerCase().includes(wardFilter);
                const matchesSentiment = !sentimentFilter || feedback.sentiment === sentimentFilter;
                const matchesRating = !ratingFilter || feedback.rating.toString() === ratingFilter;

                return matchesSearch && matchesWard && matchesSentiment && matchesRating;
            });

            populateTable(filteredData);
        }

        // Enhanced utility functions
        function toggleMessage(index) {
            const messageElement = document.getElementById(`message-${index}`);
            if (messageElement.style.display === 'block') {
                messageElement.style.display = 'none';
            } else {
                // Hide all other expanded messages
                document.querySelectorAll('.message-full').forEach(el => {
                    el.style.display = 'none';
                });
                messageElement.style.display = 'block';
            }
        }

        function sortTable(columnIndex) {
            console.log(`Sorting by column ${columnIndex}`);
            // Enhanced sorting logic would go here
        }

        function updateTimeframe(period) {
            console.log(`Updating timeframe to ${period}`);
            // Update chart data based on timeframe
        }

        function toggleChartType(type) {
            console.log(`Switching to ${type} chart`);
            // Switch between bar and radar chart
        }

        function exportData() {
            console.log('Exporting data...');
            // Export functionality
        }

        // Enhanced counter animation
        function animateCounter(elementId, targetValue, duration = 3000, isDecimal = false) {
            const element = document.getElementById(elementId);
            const startValue = 0;
            const increment = targetValue / (duration / 16);
            let currentValue = startValue;

            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= targetValue) {
                    currentValue = targetValue;
                    clearInterval(timer);
                }
                
                if (isDecimal) {
                    element.textContent = currentValue.toFixed(1);
                } else if (elementId.includes('Rate') || elementId.includes('Score')) {
                    element.textContent = currentValue.toFixed(1) + '%';
                } else if (elementId === 'avgResponseTime') {
                    element.textContent = currentValue.toFixed(1) + 'h';
                } else {
                    element.textContent = Math.floor(currentValue).toLocaleString();
                }
            }, 16);
        }

        // Real-time updates simulation
        function updateLastUpdated() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            document.getElementById('lastUpdated').textContent = timeString;
        }

        // Enhanced API placeholder functions
        async function fetchFeedbackData() {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1000));
            return feedbackData;
        }

        async function fetchSummaryStats() {
            await new Promise(resolve => setTimeout(resolve, 800));
            return {
                totalFeedback: 2847,
                averageRating: 4.3,
                positiveFeedback: 2156,
                negativeFeedback: 341,
                resolutionRate: 87.3,
                engagementScore: 92.1,
                responseRate: 94.2,
                avgResponseTime: 2.4,
                satisfactionScore: 4.3
            };
        }

        // Enhanced initialization
        async function initializeFeedbackSection() {
            try {
                // Show loading state
                document.querySelector('.citizen-feedback-section').classList.add('loading');

                // Initialize charts first
                initializeCharts();

                // Fetch and animate summary stats
                const stats = await fetchSummaryStats();
                
                // Animate main counters
                animateCounter('totalFeedback', stats.totalFeedback);
                animateCounter('averageRating', stats.averageRating, 3000, true);
                animateCounter('positiveFeedback', stats.positiveFeedback);
                animateCounter('negativeFeedback', stats.negativeFeedback);
                animateCounter('resolutionRate', stats.resolutionRate);
                animateCounter('engagementScore', stats.engagementScore);
                
                // Animate header stats
                animateCounter('responseRate', stats.responseRate);
                animateCounter('avgResponseTime', stats.avgResponseTime, 3000, true);
                animateCounter('satisfactionScore', stats.satisfactionScore, 3000, true);

                // Fetch and display feedback data
                const feedback = await fetchFeedbackData();
                populateTable(feedback);

                // Add event listeners
                document.getElementById('searchInput').addEventListener('input', filterFeedback);
                document.getElementById('wardFilter').addEventListener('change', filterFeedback);
                document.getElementById('sentimentFilter').addEventListener('change', filterFeedback);
                document.getElementById('ratingFilter').addEventListener('change', filterFeedback);

                // Start real-time updates
                setInterval(updateLastUpdated, 60000); // Update every minute
                
                // Remove loading state
                document.querySelector('.citizen-feedback-section').classList.remove('loading');

            } catch (error) {
                console.error('Error initializing feedback section:', error);
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeFeedbackSection);

        // Handle window resize for charts
        window.addEventListener('resize', () => {
            if (sentimentChart) sentimentChart.resize();
            if (wardChart) wardChart.resize();
            if (departmentChart) departmentChart.resize();
            if (responseChart) responseChart.resize();
            if (keywordChart) keywordChart.resize();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9707013f155e37b4',t:'MTc1NTQxMDk5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
